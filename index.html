<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<link rel="stylesheet" href="assets/css/reset.css">
		<link rel="stylesheet" href="assets/css/style.css">
		<title>Star Wars RPG</title>
	</head>
	<body>
		<canvas id="starfield"></canvas>
		<div id="wrapper">
			<div id="screen">
				<h1>Star Wars RPG</h1>
			</div>
		</div>

		<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha384-xBuQ/xzmlsLoJpyjoggmTEz8OWUFM0/RC5BsqQBDX2v5cMvDHcMakNTNrHIW2I5f" crossorigin="anonymous"></script>
		<script src="assets/js/game.js" charset="utf-8"></script>
		<script type="text/javascript">
		var Starfield = function(canvas) {
			this.canvas = canvas;

			var width = 6000;
			var height = 6000;
			var area = width * height;
			var density = 0.001;
			var speed = 0.005;
			var N = Math.floor(area*density);
			this.stars = new Array(N);
			for (var i = 0; i < N; i++) {
				var x = Math.random()*width;
				var y = Math.random()*height;
				var size = Math.floor(Math.random()*3) + 1;
				var dx = (2*Math.random()-1)*speed*size*size;
				var dy = (2*Math.random()-1)*speed*size*size;
				this.stars[i] = {
					"x": x, "y": y,
					"dx": dx, "dy": dy,
					"size": size
				};
			}

			this.draw = function() {
				var ctx = this.canvas.getContext("2d");
				ctx.fillStyle = "#000";
				ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
				ctx.fillStyle = "#fff";
				for (var n = 0; n < this.stars.length; n++) {
					var star = this.stars[n];
					if (star.x < this.canvas.width && star.y < this.canvas.height) {
						ctx.fillRect(Math.floor(star.x), Math.floor(star.y), star.size, star.size);
					}
					star.x = (star.x + star.dx + 6000) % 6000;
					star.y = (star.y + star.dy + 6000) % 6000;
					this.stars[n] = star;
				}
			};
		}

		var starfieldCanvas = $("#starfield")[0];
		var starfield;
		var luke, leia, trooper, vader;

		// var lastFrame = Date.now();
		function drawScreen() {
			starfield.draw();
			// var delta = Date.now() - lastFrame;
			// lastFrame += delta;
			// console.log(delta);
			// requestAnimationFrame(drawScreen);
		}

		$(document).ready(function() {
			starfieldCanvas.width = document.body.clientWidth;
			starfieldCanvas.height = document.body.clientHeight;
			starfield = new Starfield(starfieldCanvas);

			luke = new Character("luke", "Luke Skywalker", "Lightsaber", 4, 90);
			$("#screen").append(CharacterView(luke));
			$("<div>").addClass("clear").appendTo($("#screen"));
			drawScreen();
		});

		// var lastResize = Date.now();
		$(window).resize(function() {
			// var delta = Date.now() - lastResize;
			// console.log(delta);
			// lastResize += delta;
			starfieldCanvas.width = document.body.clientWidth;
			starfieldCanvas.height = document.body.clientHeight;
			starfield.draw();
		});
		</script>
	</body>
</html>
